# Веб-мессенджер

Мессенджер в стиле Telegram: слева — контакты, справа — переписка. Без историй.

## Возможности

- Вход по логину и паролю
- Админ задаётся в `.env`; остальные пользователи хранятся в зашифрованном файле `data/users.enc`
- Админ может добавлять, редактировать и удалять пользователей
- Сообщения шифруются динамическим ключом (свой ключ на каждый диалог); при выходе данные на клиенте очищаются

## Запуск

1. Установить зависимости:
   ```bash
   npm install
   ```

2. Создать файл `.env` в корне проекта (по образцу `.env.example`):
   ```
   ADMIN_LOGIN=admin
   ADMIN_PASSWORD=ваш_надёжный_пароль
   SECRET_KEY=строка_не_короче_32_символов_для_шифрования!!
   PORT=3000
   ```

3. Запустить сервер:
   ```bash
   npm start
   ```

4. Открыть в браузере: http://localhost:3000

## Запуск в Docker (Traefik)

Сборка и запуск в сети Traefik `traefik-public`:

```bash
docker compose up -d --build
```

Перед запуском убедитесь, что сеть создана: `docker network create traefik-public`.

Данные приложения (пользователи, сообщения) сохраняются в volume `messenger-data`.

**Домен для Traefik:** по умолчанию используется хост `messenger.local`. Чтобы задать свой домен, при запуске задайте переменную окружения:

```bash
TRAEFIK_HOST=chat.example.com docker compose up -d --build
```

Либо добавьте в `docker-compose.yml` в секцию `labels` свой `Host(...)` или пропишите `TRAEFIK_HOST` в `.env` в корне проекта (переменная подставляется в `docker-compose.yml` при запуске).

Роутер привязан к entrypoint `web`. Для HTTPS добавьте в `labels` роутер с `entrypoints=websecure` и при необходимости middleware для редиректа HTTP→HTTPS в вашей конфигурации Traefik.

## Использование

- Войдите под админом (логин/пароль из `.env`) или под обычным пользователем (его должен создать админ).
- Админ: кнопка ⚙ в шапке слева открывает панель управления пользователями (добавление, смена пароля/имени, удаление).
- Выберите контакт в списке слева и пишите сообщения справа. При выходе сессия сбрасывается, сообщения на клиенте не хранятся.
